using System.Collections;
using System.Collections.Generic;
using UnityEditor;
using UnityEngine;
using static UnityEngine.GraphicsBuffer;

public class Asteroid : MonoBehaviour
{
    Rigidbody rigid;
    bool isAlive;
    Vector2 dirvec;
    public float speed;
    public Vector2 spawnPos;
    public float lifeTime;
    GameObject player;

    void Start()
    {
        player = GameManger.Instance.player;
        rigid = GetComponent<Rigidbody>();
        dirvec = GetRandomDirection();
        isAlive = true;
        spawnPos = transform.position;
        
    }

    private void FixedUpdate()
    {
        if (!isAlive)
        {
            return;
        }
        
        Vector3 nextvec = dirvec * speed * Time.fixedDeltaTime;
        nextvec.z = 0;

        rigid.MovePosition(rigid.position + nextvec);

        if (Vector2.Distance(transform.position, spawnPos) > lifeTime)
        {
            isAlive = false;
            this.gameObject.SetActive(false);
        }
        
    }

    private void LateUpdate()
    {
        if (!isAlive)
            return;
           
    }

    public void OnActive()
    {
        if (!player)
            player = GameManger.Instance.player;
        dirvec = GetRandomDirection();
        
        isAlive = true;
    }

    Vector2 GetRandomDirection()
    {
        // 타겟 위치에서 현재 위치를 빼서 방향 벡터를 구합니다.
        
        Vector2 direction = (Vector2)player.transform.position - (Vector2)transform.position;

        // 벡터의 각도를 구합니다.
        float angle = Mathf.Atan2(direction.y, direction.x) * Mathf.Rad2Deg;

        // 45 ~ -45도 사이의 랜덤한 각도를 생성합니다.
        float randomAngle = Random.Range(-45, 45);

        // 랜덤 각도를 기존 각도에 더합니다.
        angle += randomAngle;

        // 최종 각도를 라디안으로 변환한 후, 그 각도에 따른 방향 벡터를 구합니다.
        float radian = angle * Mathf.Deg2Rad;

        return new Vector2(Mathf.Cos(radian), Mathf.Sin(radian));
    }
}
